---
import { giscus } from "../site.config";
---

{giscus.enabled && (
  <div class="giscus mt-16"></div>
  <script is:inline define:vars={{ giscus }}>
    const getTheme = () => {
      return document.documentElement.classList.contains("dark") ? "dark" : "light";
    };

    const script = document.createElement("script");
    const theme = getTheme();

    Object.entries({
      src: "https://giscus.app/client.js",
      "data-repo": giscus.repo,
      "data-repo-id": giscus.repoId,
      "data-category": giscus.category,
      "data-category-id": giscus.categoryId,
      "data-mapping": giscus.mapping,
      "data-strict": "0",
      "data-reactions-enabled": "1",
      "data-emit-metadata": "0",
      "data-input-position": "top",
      "data-theme": theme,
      "data-lang": "ko",
      "data-loading": "lazy",
      crossorigin: "anonymous",
      async: true,
    }).forEach(([key, value]) => {
      script.setAttribute(key, value);
    });

    document.querySelector(".giscus")?.appendChild(script);

    // Sync theme updates
    const observer = new MutationObserver(() => {
      const newTheme = getTheme();
      const iframe = document.querySelector("iframe.giscus-frame");
      if (!iframe) return;
      
      iframe.contentWindow.postMessage(
        { giscus: { setConfig: { theme: newTheme } } },
        "https://giscus.app"
      );
    });

    observer.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] });
  </script>
)}
